.text:00512B60 ; void __cdecl f_CalculateBoundsForNiNode(NiNode *a1, NiVector3 *a2, NiVector3 *a3, NiVector3 *zero, NiMatrix33 *identity, int a6)
.text:00512B60 f_CalculateBoundsForNiNode proc near    ; CODE XREF: f_CalculateBoundsForNiNode+11Fp
.text:00512B60                                         ; sub_513A80+D0p
.text:00512B60
.text:00512B60 var_64          = dword ptr -64h
.text:00512B60 var_60          = dword ptr -60h
.text:00512B60 var_5C          = dword ptr -5Ch
.text:00512B60 var_58          = dword ptr -58h
.text:00512B60 var_54          = dword ptr -54h
.text:00512B60 var_50          = dword ptr -50h
.text:00512B60 var_4C          = dword ptr -4Ch
.text:00512B60 var_48          = dword ptr -48h
.text:00512B60 var_44          = dword ptr -44h
.text:00512B60 var_40          = dword ptr -40h
.text:00512B60 var_3C          = dword ptr -3Ch
.text:00512B60 var_38          = dword ptr -38h
.text:00512B60 var_34          = dword ptr -34h
.text:00512B60 var_30          = dword ptr -30h
.text:00512B60 var_2C          = dword ptr -2Ch
.text:00512B60 var_28          = dword ptr -28h
.text:00512B60 var_24          = byte ptr -24h
.text:00512B60 arg_0           = dword ptr  4
.text:00512B60 arg_4           = dword ptr  8
.text:00512B60 arg_8           = dword ptr  0Ch
.text:00512B60 zero            = dword ptr  10h
.text:00512B60 identity        = dword ptr  14h
.text:00512B60 arg_14          = dword ptr  18h

		sub     esp, 64h
		push    esi
		mov     esi, [esp+6Ch]
		test    esi, esi
		jz      loc_512EF5
		mov     eax, [esi]
		mov     edx, [eax+8]
		push    ebx
		mov     ecx, esi
		call    edx
		mov     ebx, eax
		test    ebx, ebx
		jz      loc_512C97
		push    edi
		movzx   edi, word ptr [ebx+0B6h]
		test    edi, edi
		jz      loc_512C90
		push    ebp
		mov     ebp, [esp+84h]
		lea     esp, [esp+0]
		loc_512BA0:                             ; CODE XREF: f_CalculateBoundsForNiNode+129j
		movzx   eax, word ptr [ebx+0B6h]
		sub     edi, 1
		cmp     eax, edi
		jbe     loc_512C87
		mov     ecx, [ebx+0B0h]
		mov     esi, [ecx+edi*4]
		test    esi, esi
		jz      loc_512C87
		mov     ecx, [esp+88h]
		lea     edx, [esi+30h]
		push    edx
		lea     eax, [esp+54h]
		push    eax
		call    sub_704F70
		fld     dword ptr [esi+60h]
		mov     ecx, [esp+8Ch]
		fmul    dword ptr [ecx]
		mov     ecx, [esp+88h]
		add     esi, 54h
		push    esi
		lea     edx, [esp+3Ch]
		fstp    dword ptr [esp+14h]
		push    edx
		call    sub_7050C0
		mov     ecx, [esp+8Ch]
		fld     dword ptr [ecx]
		movzx   edx, word ptr [ebx+0B6h]
		cmp     edx, edi
		fstp    dword ptr [esp+78h]
		fld     dword ptr [esp+78h]
		fld     dword ptr [eax]
		fmul    st, st(1)
		fstp    dword ptr [esp+14h]
		fld     dword ptr [eax+4]
		fmul    st, st(1)
		fstp    dword ptr [esp+18h]
		fmul    dword ptr [eax+8]
		fstp    dword ptr [esp+1Ch]
		fld     dword ptr [ebp+0]
		fadd    dword ptr [esp+14h]
		fstp    dword ptr [esp+20h]
		fld     dword ptr [ebp+4]
		fadd    dword ptr [esp+18h]
		fstp    dword ptr [esp+24h]
		fld     dword ptr [ebp+8]
		fadd    dword ptr [esp+1Ch]
		fstp    dword ptr [esp+28h]
		ja      loc_512C56
		xor     eax, eax
		jmp     loc_512C5F

		loc_512C56:                             ; CODE XREF: f_CalculateBoundsForNiNode+F0j
		mov     eax, [ebx+0B0h]
		mov     eax, [eax+edi*4]
		loc_512C5F:                             ; CODE XREF: f_CalculateBoundsForNiNode+F4j
		lea     ecx, [esp+10h]
		push    ecx
		lea     edx, [esp+54h]
		push    edx
		mov     edx, [esp+88h]
		lea     ecx, [esp+28h]
		push    ecx
		mov     ecx, [esp+88h]
		push    edx
		push    ecx
		push    eax
		call    f_CalculateBoundsForNiNode
		add     esp, 18h
		loc_512C87:                             ; CODE XREF: f_CalculateBoundsForNiNode+4Cj
								; f_CalculateBoundsForNiNode+5Dj
		test    edi, edi
		jnz     loc_512BA0
		pop     ebp
		loc_512C90:                             ; CODE XREF: f_CalculateBoundsForNiNode+2Ej
		pop     edi
		pop     ebx
		pop     esi
		add     esp, 64h
		retn

		loc_512C97:                             ; CODE XREF: f_CalculateBoundsForNiNode+1Ej
		mov     edx, [esi]
		mov     eax, [edx+10h]
		mov     ecx, esi
		call    eax
		test    eax, eax
		jz      loc_512EF4
		mov     eax, [esi+0B4h]
		fld     ds:dword_92DF24
		movzx   edx, word ptr [eax+8]
		test    edx, edx
		mov     ecx, [eax+1Ch]
		fst     dword ptr [esp+30h]
		fst     dword ptr [esp+34h]
		fstp    dword ptr [esp+38h]
		fld     ds:flt_930610
		fst     dword ptr [esp+3Ch]
		fst     dword ptr [esp+40h]
		fstp    dword ptr [esp+44h]
		jz      loc_512D75
		loc_512CE1:                             ; CODE XREF: f_CalculateBoundsForNiNode+20Fj
		fld     dword ptr [ecx]
		sub     edx, 1
		fld     dword ptr [esp+30h]
		fcompp
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512CF9
		fld     dword ptr [ecx]
		fstp    dword ptr [esp+30h]
		loc_512CF9:                             ; CODE XREF: f_CalculateBoundsForNiNode+191j
		fld     dword ptr [ecx]
		fld     dword ptr [esp+3Ch]
		fcompp
		fnstsw  ax
		test    ah, 5
		jp      loc_512D0E
		fld     dword ptr [ecx]
		fstp    dword ptr [esp+3Ch]
		loc_512D0E:                             ; CODE XREF: f_CalculateBoundsForNiNode+1A6j
		fld     dword ptr [ecx+4]
		fld     dword ptr [esp+34h]
		fcompp
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512D25
		fld     dword ptr [ecx+4]
		fstp    dword ptr [esp+34h]
		loc_512D25:                             ; CODE XREF: f_CalculateBoundsForNiNode+1BCj
		fld     dword ptr [ecx+4]
		fld     dword ptr [esp+40h]
		fcompp
		fnstsw  ax
		test    ah, 5
		jp      loc_512D3C
		fld     dword ptr [ecx+4]
		fstp    dword ptr [esp+40h]
		loc_512D3C:                             ; CODE XREF: f_CalculateBoundsForNiNode+1D3j
		fld     dword ptr [ecx+8]
		fld     dword ptr [esp+38h]
		fcompp
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512D53
		fld     dword ptr [ecx+8]
		fstp    dword ptr [esp+38h]
		loc_512D53:                             ; CODE XREF: f_CalculateBoundsForNiNode+1EAj
		fld     dword ptr [ecx+8]
		fld     dword ptr [esp+44h]
		fcompp
		fnstsw  ax
		test    ah, 5
		jp      loc_512D6A
		fld     dword ptr [ecx+8]
		fstp    dword ptr [esp+44h]
		loc_512D6A:                             ; CODE XREF: f_CalculateBoundsForNiNode+201j
		add     ecx, 0Ch
		test    edx, edx
		jnz     loc_512CE1
		loc_512D75:                             ; CODE XREF: f_CalculateBoundsForNiNode+17Bj
		mov     eax, [esp+7Ch]
		lea     ecx, [esp+18h]
		push    ecx
		mov     ecx, [esp+84h]
		lea     edx, [esp+34h]
		push    edx
		push    2
		push    eax
		push    ecx
		call    sub_705450
		fld     dword ptr [esp+38h]
		mov     eax, [esp+2Ch]  ; shadeMe: NiVector3::x ?
		fld     st
		fld     dword ptr [esp+2Ch]
		mov     ecx, [esp+30h]
		mov     edx, [esp+34h]
		fcom    st(1)
		mov     [esp+50h], eax
		mov     [esp+44h], eax
		add     esp, 14h
		fnstsw  ax
		mov     [esp+40h], ecx
		mov     [esp+44h], edx
		test    ah, 41h
		mov     [esp+34h], ecx
		mov     [esp+38h], edx
		jnz     loc_512DD5
		fxch    st(2)
		fst     dword ptr [esp+30h]
		fxch    st(2)
		loc_512DD5:                             ; CODE XREF: f_CalculateBoundsForNiNode+26Bj
		fcompp
		fnstsw  ax
		test    ah, 5
		jp      loc_512DE4
		fstp    dword ptr [esp+3Ch]
		jmp     loc_512DE6

		loc_512DE4:                             ; CODE XREF: f_CalculateBoundsForNiNode+27Cj
		fstp    st
		loc_512DE6:                             ; CODE XREF: f_CalculateBoundsForNiNode+282j
		fld     dword ptr [esp+28h]
		fld     st
		fld     dword ptr [esp+34h]
		fcom    st(1)
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512E0B
		fstp    st
		fxch    st(1)
		fst     dword ptr [esp+34h]
		fld     dword ptr [esp+34h]
		fxch    st(1)
		fxch    st(2)
		fxch    st(1)
		loc_512E0B:                             ; CODE XREF: f_CalculateBoundsForNiNode+297j
		fld     dword ptr [esp+40h]
		fcom    st(2)
		fnstsw  ax
		fstp    st(2)
		test    ah, 5
		jp      loc_512E28
		fstp    st(1)
		fxch    st(1)
		fstp    dword ptr [esp+40h]
		fld     dword ptr [esp+40h]
		jmp     loc_512E2A

		loc_512E28:                             ; CODE XREF: f_CalculateBoundsForNiNode+2B8j
		fstp    st(2)
		loc_512E2A:                             ; CODE XREF: f_CalculateBoundsForNiNode+2C6j
		fld     dword ptr [esp+2Ch]
		fld     st
		fld     dword ptr [esp+38h]
		fcom    st(1)
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512E4F
		fstp    st
		fxch    st(1)
		fst     dword ptr [esp+38h]
		fld     dword ptr [esp+38h]
		fxch    st(1)
		fxch    st(2)
		fxch    st(1)
		loc_512E4F:                             ; CODE XREF: f_CalculateBoundsForNiNode+2DBj
		fld     dword ptr [esp+44h]
		fcom    st(2)
		fnstsw  ax
		fstp    st(2)
		test    ah, 5
		jp      loc_512E6C
		fstp    st(1)
		fxch    st(1)
		fstp    dword ptr [esp+44h]
		fld     dword ptr [esp+44h]
		jmp     loc_512E6E

		loc_512E6C:                             ; CODE XREF: f_CalculateBoundsForNiNode+2FCj
		fstp    st(2)
		loc_512E6E:                             ; CODE XREF: f_CalculateBoundsForNiNode+30Aj
		fld     dword ptr [esp+30h]
		mov     edx, [esp+74h]
		fld     dword ptr [edx]
		fcomp   st(1)
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512E85
		fstp    dword ptr [edx]
		jmp     loc_512E87

		loc_512E85:                             ; CODE XREF: f_CalculateBoundsForNiNode+31Fj
		fstp    st
		loc_512E87:                             ; CODE XREF: f_CalculateBoundsForNiNode+323j
		fld     dword ptr [esp+3Ch]
		mov     ecx, [esp+78h]
		fld     dword ptr [ecx]
		fcomp   st(1)
		fnstsw  ax
		test    ah, 5
		jp      loc_512E9E
		fstp    dword ptr [ecx]
		jmp     loc_512EA0

		loc_512E9E:                             ; CODE XREF: f_CalculateBoundsForNiNode+338j
		fstp    st
		loc_512EA0:                             ; CODE XREF: f_CalculateBoundsForNiNode+33Cj
		fld     dword ptr [edx+4]
		fcomp   st(4)
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512EB3
		fxch    st(3)
		fstp    dword ptr [edx+4]
		jmp     loc_512EB5

		loc_512EB3:                             ; CODE XREF: f_CalculateBoundsForNiNode+34Aj
		fstp    st(3)
		loc_512EB5:                             ; CODE XREF: f_CalculateBoundsForNiNode+351j
		fld     dword ptr [ecx+4]
		fcomp   st(2)
		fnstsw  ax
		test    ah, 5
		jp      loc_512EC8
		fxch    st(1)
		fstp    dword ptr [ecx+4]
		jmp     loc_512ECA

		loc_512EC8:                             ; CODE XREF: f_CalculateBoundsForNiNode+35Fj
		fstp    st(1)
		loc_512ECA:                             ; CODE XREF: f_CalculateBoundsForNiNode+366j
		fld     dword ptr [edx+8]
		fcomp   st(1)
		fnstsw  ax
		test    ah, 41h
		jnz     loc_512EDB
		fstp    dword ptr [edx+8]
		jmp     loc_512EDD

		loc_512EDB:                             ; CODE XREF: f_CalculateBoundsForNiNode+374j
		fstp    st
		loc_512EDD:                             ; CODE XREF: f_CalculateBoundsForNiNode+379j
		fld     dword ptr [ecx+8]
		fcomp   st(1)
		fnstsw  ax
		test    ah, 5
		jp      loc_512EF2
		pop     ebx
		fstp    dword ptr [ecx+8]
		pop     esi
		add     esp, 64h
		retn

		loc_512EF2:                             ; CODE XREF: f_CalculateBoundsForNiNode+387j
		fstp    st
		loc_512EF4:                             ; CODE XREF: f_CalculateBoundsForNiNode+142j
		pop     ebx
		loc_512EF5:                             ; CODE XREF: f_CalculateBoundsForNiNode+Aj
		pop     esi
		add     esp, 64h
		retn